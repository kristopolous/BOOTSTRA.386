<!DOCTYPE html>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta http-equiv='cache-control' content='no-cache'>
<meta http-equiv='expires' content='0'>
<meta http-equiv='pragma' content='no-cache'>
<style>
@font-face {
  font-family: 'dos';
  src: url('Px437_IBM_EGA8.otf') format('opentype');
}
#screen {
  width: 42rem;
  height: 29rem;
  padding: 1rem 0.25rem;
  overflow: hidden;
  position: relative;
  background: rgb(112,112,112);
  background: radial-gradient(circle, rgba(40,44,49,1) 90%, rgba(12,14,16,1) 100%);
  border-top: 24px solid #5b5b53;
  border-left: 30px solid #3b3d38;
  border-bottom: 28px solid #7f7c77;
  border-radius: 10px;
  border-right: 30px solid #86857f;
  text-shadow: 
    0px 0 2px lime,
    -1px 0 1px lime;
}
#screenborder {
  position: relative;
  width: 42rem;
  height: 100%;
  padding-left: 0.5rem;
  overflow: hidden;
}


#content {
  position: absolute;
}
body { 
  margin: 1rem;
  background: black;
  height: calc(100vh - 2rem);
  line-height: 16px;
  color: lime;
  font-size: 15px;
}

a, a:visited {
  color: lime;
}
#igroup {
  display: inline;
  position:relative;
}
#cursor {
  position: absolute;
  left: 0;
  border-bottom: 2px lime;
  height: 1rem;
  display:inline-block;
  animation: blink-animation 0.5s steps(2, start) infinite;
}
input {
  background: transparent;
  color: lime;
  text-transform: uppercase;
  font-family: 'dos', monospace;
  border: 0;
  font-size: 15px;
  width: 50%;
  caret-color: transparent;
  margin-left: 1.75px;
  text-shadow: 
    0px 0 2px lime,
    -1px 0 1px lime;
}
input:focus, input:active {
  outline: 0;
}
pre{ 
  font-family: 'dos', monospace;
  line-height: 19px;
  display: inline; }
@keyframes blink-animation {
  to {
    opacity: 0.1;
  }
}
@media only screen and (min-width: 79px) and (max-width: 1281px) {
#screen {
  width: calc(100% - 20px - .5rem);
  height: calc(100vh - 15px - 2rem);
  padding: 1rem 0.25rem;
  overflow: hidden;
  position: relative;
    background: #b5b9ab;
  border-top: 5px solid #727876;
  border-left: 10px solid #abadaa;
  border-bottom: 10px solid #7a7b6d;
  border-right: 10px solid #7a7b6d;
    color: #493f35;
    border-radius: 0;
  text-shadow: 3px 3px 0 rgba(52,56,51,0.15);
}
a, a:visited {
    color: #493f35;
}
input {
    color: #493f35;
  text-shadow: none;
}
  body {
    margin:0;
  }
}
</style>

<div id=screen>
<div id=screenborder>
<div id=content>
<pre>
</pre>
<div id=igroup><input onkeydown=move(this) onkeyup=move(this) type="text"><div id=cursor>_</div></div>

</div>
</div>
</div>
<script>
let dir=`
Directory of A:\\.
BS2     COM       152264 11-04-2013 12:00
BS3     COM       423842 03-02-2015 12:00
BS4     COM       732140 08-22-2020 12:00
BS5     COM       821111 09-13-2023 12:00
   4 File(s)     2129357 Bytes.
   0 Dir(s)            0 Bytes free.
`;
let txt=`
    ____              __       __            
   / __ )____  ____  / /______/ /__________ _
  / __  / __ \\/ __ \\/ __/ ___/ __/ ___/ __ '/
 / /_/ / /_/ / /_/ / /_(__  ) /_/ /  / /_/ / 
/_____/\\____/\\____/\\__/____/\\__/_/   \\__,_/  
           _____ ____  _____
          |__  /( __ )/ ___/
           /_ </ __  / __ \\ 
         ___/ / /_/ / /_/ / 
        /____/\\____/\\____/  

     Welcome to Bootstra/386
     BOOTSTRA386.COM

     There are 4 demos 

     BS2.COM  - Bootstra/386 2.0
     BS3.COM  - Bootstra/386 3.0
     BS4.COM  - Bootstra/386 4.0
     BS5.COM  - Bootstra/386 5.0
     
A:\\>`;

let cont,cursor, inp, dsp, buffer ='',ival,
  href = {
    'BS2': 'http://kristopolous.github.io/BOOTSTRA.386/v2.3.1/',
    'BS3': 'http://kristopolous.github.io/BOOTSTRA.386/v3.3.2/',
    'BS4': 'http://kristopolous.github.io/BOOTSTRA.386/v4.4.1/',
    'BS5': 'http://kristopolous.github.io/BOOTSTRA.386/v5.3.1/',
    'BOOTSTRA386': 'https://bootstra386.com/'
  };
  const LH = 20;
window.addEventListener(
  'keydown',
  (ev) => {
    //dbg.innerHTML += ev.code + " ";
    let cmd = inp.value.toUpperCase().trim();
    if(ev.code == 'Enter') {
      inp.value = '';
      addText(" " + cmd);
      let noext = cmd.replace(/\.*/, '');
      if(cmd === 'DIR') {
        addText(dir);
      } else if(cmd == 'VER') {
        addText('\nBS-DOS version 0.');
      } else if(cmd == 'REBOOT') {
        location.reload();
      } else if(cmd == 'CLS') {
        linenum = 0;
        content.style.top = 0;
        buffer = '';
        dsp.innerHTML = '';
      } else if(href[noext]) {
        window.location = href[noext];
        return;
      } else {
        addText(`\nIllegal Command: ${cmd}.\n`);
      }
      addText('\nA:\\\>');
      
    }
  }
);
function bl(el) {
  inp.focus();
}
function move(el) {
  cursor.style.left = el.value.length * 9 + 3 +'px';
}

let linenum = 0;
function addText(toadd) {
  let ix = 0;
  buffer += toadd;
  let lineCount = Math.floor((content.parentNode.parentNode.getBoundingClientRect().height - 60) / LH);
  console.log(lineCount);
  if(!ival) {
    ival = setInterval(() => {
      if(buffer[ix] == '\n') {
        linenum++;
        let top = - (Math.max(linenum - lineCount, 0) * LH) + "px";
        content.style.top = top;
      }
      dsp.innerHTML += buffer[ix];
      ix++;
      if(ix >= buffer.length) {
        for(const [key, url] of Object.entries(href)) {
          dsp.innerHTML = dsp.innerHTML.replace(new RegExp(`${key}(\s*\.?)COM`), `<a href=${url}>${key}$1COM</a>`);
        }
        clearInterval(ival);
        ival = 0;
        buffer = '';
        inp.focus();
      }
    },4);
  }
}
window.onload = () => {
  dsp = document.body.getElementsByTagName('pre')[0];
  inp = document.body.getElementsByTagName('input')[0];
  cursor = document.querySelector('#cursor');
  cont = document.querySelector('#content');
  dbg = document.querySelector('#dbg');
  inp.focus();

  setInterval( () => inp.focus(), 100);
 
  let ram = 64, ival = setInterval(() => {
      dsp.innerHTML = `${ram} KB OK`;
      ram += 64;
      if(ram > 640) {
        clearInterval(ival);
        addText(txt);
      }
    }, 400);
}


</script>
